ALTER ALGORITHM=UNDEFINED DEFINER=`shiftkh`@`localhost` SQL SECURITY DEFINER VIEW `v_notification` AS select `n`.`pk_i_id` AS `pk_i_id`,`n`.`fk_i_actor_user_id` AS `fk_i_actor_user_id`,`n`.`i_target_users_type` AS `i_target_users_type`,`n`.`i_title_type` AS `i_title_type`,`n`.`s_ids` AS `s_ids`,`n`.`request_id` AS `request_id`,`n`.`i_action` AS `i_action`,(case when (`n`.`i_action` = 0) then '#' when (`n`.`i_action` = 1) then '#' when (`n`.`i_action` = 2) then '#' when (`n`.`i_action` = 3) then '#' end) AS `s_url`,(case `n`.`i_title_type` when 1 then `get_notification_title`(if((`get_current_language_code`() = 'ar'),`nt`.`s_template_ar`,`nt`.`s_template_en`),if((`get_current_language_code`() = 'ar'),`n`.`s_title_ar`,`n`.`s_title_en`)) when 2 then if((`get_current_language_code`() = 'ar'),`n`.`s_title_ar`,`n`.`s_title_en`) end) AS `s_title`,`n`.`s_title_en` AS `s_title_en`,`n`.`s_title_ar` AS `s_title_ar`,(case when (`get_current_language_code`() = 'ar') then `n`.`s_title_ar` when (`get_current_language_code`() = 'en') then `n`.`s_title_en` end) AS `title`,`n`.`fk_i_notification_template_id` AS `fk_i_notification_template_id`,`n`.`b_enabled` AS `b_enabled`,`n`.`dt_created_date` AS `dt_created_date`,`n`.`dt_modified_date` AS `dt_modified_date`,`n`.`dt_deleted_date` AS `dt_deleted_date` from ((`t_notification` `n` left join `t_notification_user` `nu` on(((`nu`.`fk_i_notification_id` = `n`.`pk_i_id`) and (((`n`.`i_target_users_type` = 2) and (`nu`.`fk_i_user_id` = `get_current_user_id`())) or ((`n`.`i_target_users_type` = 1) and (`nu`.`fk_i_user_id` = `get_current_user_id`())) or ((`n`.`i_target_users_type` = 1) and isnull(`nu`.`fk_i_user_id`)))))) left join `t_notification_template` `nt` on((`nt`.`pk_i_id` = `n`.`fk_i_notification_template_id`))) where (((`n`.`i_target_users_type` = 2) and (`nu`.`fk_i_user_id` = `get_current_user_id`())) or ((`n`.`i_target_users_type` = 1) and (`nu`.`fk_i_user_id` = `get_current_user_id`())) or ((`n`.`i_target_users_type` = 1) and isnull(`nu`.`fk_i_user_id`)))



BEGIN
	RETURN IFNULL(@s_language_code,'en');
END

